@model CityLibrary.Web.ViewModels.BorrowViewModel 
<!-- Przekazanie POST -->
@using (Html.BeginForm("AddBorrow", "Borrow"))
{
       
    <script type="text/javascript">

        var borrowBooks = null;
        
        this.loadBooksToBorrow = function () {
            var x = $.ajax({
                type: "POST",
                url: '/Borrow/GetBooksToBorrow',
                async: false,
                success: function (data) {
                    borrowBooks = data.Books;
                },
                error: function (err) {
                    if (typeof console !== 'undefined') {
                        console.log('Error occured while getting response from method: ' + method + '. Response: ' + err.responseMessage);
                    }
                    alert('Błąd podczas pobierania książek do nowego wypożyczania');
                }
            });
        };

        this.UserDataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: 'User/GetUsersJson',
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json'
                }
            },
            schema: {
                model: {
                    fields: {
                        UserId: { type: "number" },
                        FullName: { type: "string" }
                    }
                },
                data: "Items"
            }
        });


        $(document).ready(function () {

            $.when(loadBooksToBorrow()).done(function () {
                $("#UserId").kendoComboBox({
                    index: 0,
                    dataTextField: "FullName",
                    dataValueField: "UserId",
                    dataSource: self.UserDataSource
                });

                if (borrowBooks != null)
                {
                    alert(borrowBooks);
                }

                $('.add-next-book').live('click', function (e) {
                    e.preventDefault();

                    alert(borrowBooks);
                });
            });
        });

    </script>
    <div class="modal hide fade" id="borrow-modal">
        <div class="modal-header">
            <button class="close" data-dismiss="modal">×</button>
            <h3>Nowe wypożyczenie książki</h3>
        </div>
        <div class="modal-body">
            <div class="form-horizontal">
                <div class="control-group">
                    <div class="control-group">
                        <span class="control-label">Użytkownik</span>
                        <div class="controls">
                            @Html.TextBoxFor(m => m.UserId)
                        </div>
                    </div>
                </div>
                <div class="books">


                </div>
                <div class="control-group">
                    <div class="control-group">
                        <a href="" class="btn add-next-book">Dodaj kolejną</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <input type="submit" class="btn btn-primary" value="Zapisz" />
            <a href="#" class="btn pull-left" data-dismiss="modal">Zamknij</a>
        </div>
    </div>
}
